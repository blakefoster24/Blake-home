
# Loads default set of integrations. Do not remove.
default_config:

# Load frontend themes from the themes folder
frontend:
  themes: !include_dir_merge_named themes

automation: !include automations.yaml
script: !include scripts.yaml
scene: !include scenes.yaml

shell_command:
  ha_git_commit_push: |
    bash -c "cd /config &&
             git config user.name 'Home Assistant' &&
             git config user.email 'ha@local' &&
             git -c credential.helper='store --file=/config/.git-credentials' add -A &&
             (git diff --cached --quiet || git commit -m 'Auto commit $(date -Iseconds)') &&
             git -c credential.helper='store --file=/config/.git-credentials' push origin main"

  write_entities_md: |
    bash -lc 'cat > /config/README_entities.md << "EOF"
    {{ content }}
    EOF'

  write_helpers_md: |
    bash -lc 'cat > /config/README_helpers.md << "EOF"
    {{ content }}
    EOF'

  # Diagnostics: last 300 lines of HA log
  write_log_slice: |
    bash -lc 'mkdir -p /config/diagnostics &&
              { echo "===== $(date -Iseconds) — last 300 lines =====";
                tail -n 300 /config/home-assistant.log || true; } \
              > /config/diagnostics/last_log.txt'

  # Diagnostics: recent automation lines from the log
  write_automation_runs: |
    bash -lc 'mkdir -p /config/diagnostics &&
              { echo "===== $(date -Iseconds) — automation runs (recent) =====";
                tail -n 1000 /config/home-assistant.log | grep -E "Automation|automations" || true; } \
              > /config/diagnostics/automation_runs.txt'

  # Quick path test (optional)
  write_diag_test: |
    bash -lc 'mkdir -p /config/diagnostics &&
              echo "Diag test at $(date -Iseconds)" > /config/diagnostics/diag_test.txt'


